---
title: "For DTR, how do I remove 3DES from SSL cipers to meet security requirements?"
id: 1933
draftstate: inactive
deleted: false
source: https://success.docker.com/@api/deki/pages/1933/contents
tags:
- tag: "article:howto"
- tag: "component:dtr"
- tag: "expires:futurerelease"
- tag: "product:datacenter"
- tag: "stage:reviewed"
- tag: "testedon:dtr-2.2.3"
---
{% raw %}
<p>
 This article explains how to remove SSL ciphers that use the 3DES encryption suite from Docker Trusted Registry prior to version 2.3. If your security standards require you to remove SSL ciphers that use 3DES encryption, consider upgrading to DTR 2.3 or higher instead of performing these steps.
</p>
<div class="mt-section" id="section_1" mt-section-origin="KBase/For_DTR,_how_do_I_remove_3DES_from_SSL_cipers_to_meet_security_requirements?">
 <span id="Prerequisites">
 </span>
 <h2 id="1-0">
  Prerequisites
 </h2>
 <p>
  Before performing these steps, you must meet the following requirements:
 </p>
 <ul>
  <li>
   <p>
    Is there a security requirement to remove this support?
   </p>
  </li>
  <li>
   <p>
    Have you backed up DTR?
   </p>
  </li>
  <li>
   <p>
    Do you understand the risks of backup/restore and understand that it is not guaranteed?
   </p>
  </li>
  <li>
   <p>
    Can you upgrade to DTR 2.3 or higher instead?
   </p>
  </li>
 </ul>
</div>
<div class="mt-section" id="section_2" mt-section-origin="KBase/For_DTR,_how_do_I_remove_3DES_from_SSL_cipers_to_meet_security_requirements?">
 <span id="Steps">
 </span>
 <h2 id="1-1">
  Steps
 </h2>
 <blockquote>
  These steps were written for DTR 2.2.3. If using another version, verify the tag used is appropriate for the environment.
 </blockquote>
 <p>
  <strong>
   To remove 3DES from the ssl_ciphers option in dtr-nginx container, if possible upgrade to DTR 2.3.0 or higher. If not, follow these steps to create a new image with 3DES removed, backup DTR, uninstall DTR, and restore DTR using newly built image.
  </strong>
 </p>
 <p>
  1. Enter the dtr-nginx container:
 </p>
 <pre>
$ docker run --rm -it --name build --entrypoint sh docker/dtr-nginx:2.2.3 </pre>
 <p>
  2. In the container, backup the NGINX file, and then edit the original file:
 </p>
 <pre>
# mv /bin/nginx /bin/nginx-orig
# vi /bin/nginx</pre>
 <p>
  3. Modify the contents of the NGINX file to the following:
 </p>
 <pre>
#!/bin/sh 
sed -i 's/DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!/DH+AES:RSA+AESGCM:RSA+AES:!/' /config/nginx.conf 
exec /bin/nginx-orig "$@"</pre>
 <p>
  4. Save the file and exit it.
 </p>
 <p>
  5. Make sure the file is executable:
 </p>
 <pre>
# chmod +x /bin/nginx</pre>
 <p>
  5. In another terminal outside the container:
 </p>
 <pre>
$docker commit -c 'ENTRYPOINT ["/init", "--skip-runit", "/bin/nginxwrapper"]' build dtr-nginx-hack</pre>
 <p>
  6. Stop the original container and rename the images:
 </p>
 <pre>
$ docker stop <dtr-nginx containerid="">
$ docker tag docker/dtr-nginx:2.2.3 docker/dtr-nginx:2.2.3-orig 
$ docker tag dtr-nginx-hack docker/dtr-nginx:2.2.3</dtr-nginx>
</pre>
 <p>
  7. Backup DTR after fully reading the documentation:
 </p>
 <p class="mt-indent-1">
  <a class="link-https" href="https://docs.docker.com/datacenter/dtr/2.2/guides/admin/backups-and-disaster-recovery/#backup-dtr-data" rel="freeklink" title="https://docs.docker.com/datacenter/dtr/2.2/guides/admin/backups-and-disaster-recovery/#backup-dtr-data">
   DTR backups and recovery
  </a>
 </p>
 <p class="mt-indent-1">
  The backup command does not create a backup of Docker images. You should implement a separate backup policy for the Docker images, taking in consideration whether your DTR installation is configured to store images on the file system or using a cloud provider. During restore, you need to separately restore the image contents.
 </p>
 <p>
  8. Test the DTR backup:
 </p>
 <p class="mt-indent-1">
  <a class="link-https" href="https://docs.docker.com/datacenter/dtr/2.2/guides/admin/backups-and-disaster-recovery/#testing-backups" rel="freeklink" title="https://docs.docker.com/datacenter/dtr/2.2/guides/admin/backups-and-disaster-recovery/#testing-backups">
   DTR backups and recovery
  </a>
 </p>
 <p>
  9. Uninstall DTR:
 </p>
 <p class="mt-indent-1">
  <a class="link-https" href="https://docs.docker.com/datacenter/dtr/2.2/guides/admin/install/uninstall/" rel="freeklink" title="https://docs.docker.com/datacenter/dtr/2.2/guides/admin/install/uninstall/">
   Uninstall Docker Trusted Registry
  </a>
 </p>
 <p>
  10. Restore DTR:
 </p>
 <p>
  <a class="link-https" href="https://docs.docker.com/datacenter/dtr/2.2/guides/admin/backups-and-disaster-recovery/#restore-dtr-data" rel="freeklink" title="https://docs.docker.com/datacenter/dtr/2.2/guides/admin/backups-and-disaster-recovery/#restore-dtr-data">
   Restore DTR data
  </a>
 </p>
 <ul>
  <li>
   The DTR bootstrapper installs DTR and uses the images on the machine it's installing on.
  </li>
  <li>
   The
   <code>
    restore
   </code>
   command performs a fresh installation of DTR and reconfigures it with the configuration created during a backup. The command starts by installing DTR. Then it restores the configurations from the backup and then restores the repository metadata. Finally, it applies all of the configs specified as flags to the restore command.
  </li>
 </ul>
 <ul>
  <li>
   After restoring DTR, you must make sure that it’s configured to use the same storage backend where it can find the image data. If the image data was backed up separately, you must restore it now.
  </li>
 </ul>
 <p>
  11. Verify the container running from the new image has 3DES removed:
 </p>
 <pre>
$ docker exec 3ae582ce08fa cat /config/nginx.conf | grep ssl_ciphers 
ssl_ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS;</pre>
</div>
{% endraw %}
